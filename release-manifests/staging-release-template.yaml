release_id: YYYY-MM-DD-staging
description: Staging deployment manifest prior to production promotion

commits:
  mobius-os: <git-sha-or-tag>
  mobius-rag: <git-sha-or-tag>
  mobius-chat: <git-sha-or-tag>
  mobius-dbt: <git-sha-or-tag>
  mobius-auth: <git-sha-or-tag>
  mobius-skills: <git-sha-or-tag>
  mobius-user: <git-sha-or-tag>
  mobius-qa: <git-sha-or-tag>

images:
  mobius-os-backend: gcr.io/mobius-staging/mobius-os-backend:<tag>
  mobius-rag-backend: gcr.io/mobius-staging/mobius-rag-backend:<tag>
  mobius-rag-worker-chunking: gcr.io/mobius-staging/mobius-rag-worker-chunking:<tag>
  mobius-rag-worker-embedding: gcr.io/mobius-staging/mobius-rag-worker-embedding:<tag>
  mobius-chat-api: gcr.io/mobius-staging/mobius-chat-api:<tag>
  mobius-chat-worker: gcr.io/mobius-staging/mobius-chat-worker:<tag>
  mobius-dbt-ui: gcr.io/mobius-staging/mobius-dbt-ui:<tag>
  mobius-skills-scraper: gcr.io/mobius-staging/mobius-skills-scraper:<tag>
  module-hub: gcr.io/mobius-staging/module-hub:<tag>

migrations:
  mobius-os: <alembic_revision_id>
  mobius-rag:
    - python:add_publish_tables
    - sql:add_error_tracking.sql
  mobius-user: <alembic_revision_id>
  mobius-chat: db/schema/002_published_rag_metadata.sql
  mobius-dbt: scripts/land_and_dbt_run.sh (origin staging -> BigQuery staging)

env_overrides:
  cloudsql_connection_name: mobius-staging:us-central1:mobius-platform-staging-db
  redis_url: redis://10.121.0.3:6379/0
  gcs_bucket: mobius-rag-uploads-staging
  vertex_index_endpoint_id: projects/mobius-staging/locations/us-central1/indexEndpoints/xxxx
  vertex_deployed_index_id: mobius-chat-staging

verification:
  verify_script: ./verify_production.sh --env staging
  qa_suite: mobius-qa/mobius-chat-qa/chat_bot.py --config chat_bot_config.staging.yaml --limit 15
  dbt_test: true

notes:
  - Ensure secrets are synced in Secret Manager before running this manifest.
  - Record Cloud Build execution URL in docs/release_logs/YYYY-MM-staging.md.
